<#include "/_pagelet/constant.html"/>
<!DOCTYPE html>
<html>
	<head>
		<title>会员管理 | 管理后台 | MOMO黄金农场</title>
		<#include "/_pagelet/header.html"/>
		<link rel='stylesheet' type='text/css' media='screen' href='${(conf_html_cdn)!}js/ztree/3.5.15/css/zTreeStyle/zTreeStyle.css' />
		<style>
		#table_1 th {
			text-align: center;
		}
		#table_1 td {
			text-align: center;
		}
		.pagination {
			margin-bottom: 0;
		}
		</style>
		<style>
			ul.ztree {
				overflow-y: scroll;
				overflow-x: auto;
			}

			ul.ztree * {
				font-family: "Microsoft Yahei", Helvetica, Arial, sans-serif;
			}

			.ztree li span.button.switch.level0 {
				visibility: hidden;
				width: 1px;
			}

			.ztree li ul.level0 {
				padding: 0;
				background: none;
			}
		</style>
	</head>

	<body>
		<div class="navbar">
			<div class="navbar-inner">
				<#include "../default/_pagelet/banner.html"/>
			</div><!--/.navbar-inner-->
		</div>

		<div class="main-container container-fluid">
			<a class="menu-toggler" id="menu-toggler" href="#">
				<span class="menu-text"></span>
			</a>

			<div class="sidebar" id="sidebar">
				<div class="sidebar-shortcuts" id="sidebar-shortcuts">
					<div class="sidebar-shortcuts-large" id="sidebar-shortcuts-large">
						<button class="btn btn-small btn-success">
							<i class="icon-signal"></i>
						</button>

						<button class="btn btn-small btn-info">
							<i class="icon-pencil"></i>
						</button>

						<button class="btn btn-small btn-warning">
							<i class="icon-group"></i>
						</button>

						<button class="btn btn-small btn-danger">
							<i class="icon-cogs"></i>
						</button>
					</div>

					<div class="sidebar-shortcuts-mini" id="sidebar-shortcuts-mini">
						<span class="btn btn-success"></span>

						<span class="btn btn-info"></span>

						<span class="btn btn-warning"></span>

						<span class="btn btn-danger"></span>
					</div>
				</div><!--#sidebar-shortcuts-->

				<#include "../default/_pagelet/nav.html"/>
			</div>

			<div class="main-content">
				<div class="breadcrumbs" id="breadcrumbs">
					<ul class="breadcrumb">
						<li>
							<i class="icon-home home-icon"></i>
							<a href="/">首页</a>

							<span class="divider">
								<i class="icon-angle-right arrow-icon"></i>
							</span>
						</li>
						<li class="active">会员管理</li>
					</ul><!--.breadcrumb-->

				</div>

				<div class="page-content">
					<div class="page-header position-relative">
						<h1>
							会员管理
							<!-- <small>
								<i class="icon-double-angle-right"></i>
								Recommend List
							</small> -->
						</h1>
					</div><!--/.page-header-->

					<div class="row-fluid">
						<div class='span12'>
							<p>
								<a class="btn btn-small btn-success" href='/manage/user/add'>添加</a>
								<a class="btn btn-small btn-primary" href='javascript:edit();'>编辑</a>
								<a class="btn btn-small btn-danger" href='javascript:remove();'>删除</a>
							</p>
						</div>
					</div>

					<div class="row-fluid">

						<div class="span3 widget-container-span">
							<div class="row-fluid">
								<div class="widget-header header-color-blue2">
									<h4 class="lighter smaller">会员结构树</h4>
								</div>

								<div class="widget-body">
									<div class="widget-main padding-2">
										<ul id="menuTree" class="ztree"></ul>
									</div>
								</div>
							</div>
						</div>

						<div class="span9 widget-container-span">
							<table id="table_1" class="table table-striped table-bordered table-hover">
								<thead>
									<tr role='row'>
										<th class='center'>
											#
										</th>
										<th class='hidden-480'>会员编号</th>
										<th class='hidden-480'>姓名</th>
										<th>手机号</th>

										<th>静态钱包</th>
										<th>动态钱包</th>
										<th>门票</th>
										<th>饲料</th>
									</tr>
								</thead>
								<tbody>
								<#list data_list! as doc>
									<tr>
										<td class='center'>
											<label>
												<input type="radio" name='table_1_row' value='${(doc.id)!}'>
												<span class="lbl"></span>
											</label>
										</td>
										<td class='hidden-480'>${(doc.id)!}</td>
										<td class='hidden-480'>${(doc.real_name)!}</td>
										<td>${(doc.mobile)!}</td>

										<td>${doc.num_static?string('0.00')}</td>
										<td>${doc.num_dynamic?string('0.00')}</td>
										<td>${doc.num_ticket?string('0.00')}</td>
										<td>${doc.num_food?string('0.00')}</td>
									</tr>
								</#list>
								</tbody>
							</table>
						</div>
					</div>

				</div><!--/.page-content-->

			</div><!--/.main-content-->
		</div><!--/.main-container-->

		<a href="#" id="btn-scroll-up" class="btn-scroll-up btn btn-small btn-inverse">
			<i class="icon-double-angle-up icon-only bigger-110"></i>
		</a>

		<#include "/_pagelet/js.html"/>
		<script src='${(conf_html_cdn)!}js/ztree/3.5.15/js/jquery.ztree.core-3.5.js'></script>

		<script>
		function edit(){
			var val = $("input[name='table_1_row']:checked").val();
			if(!val) return;
			location.href = '${(conf_html_virtualPath)!}manage/user/edit?id='+ val;
		}

		function remove(){
			var val = $("input[name='table_1_row']:checked").val();
			if(!val) return;

			if (confirm('你确定要执行该操作吗？')) {
				$.ajax({
					url : '${(conf_html_virtualPath)!}manage/user/remove?id='+ val,
					type : 'POST',
					dataType : 'JSON',
					data : {},
					success : function(data) {
						if (data.success) {
							alert('删除会员成功')
							return location.href = '${(conf_html_virtualPath)!}manage/user/';
						}
						if (data.msg) alert(data.msg[0]);
					},
					error : function() {
						alert(arguments[2]);
					}
				});
			}
		}

		$(function(){
			var setting = {
				data : {
					simpleData : {
						enable : true
					}
				},
				callback : {
					beforeExpand: function(treeId, treeNode){
						/* if(treeNode.children) return;
						// TODO
						ajax({ pid: treeNode.id }, function (data){
							if(!data.success) return;
							// TODO
							var zTree = $.fn.zTree.getZTreeObj(treeId);
							for(var i in data.data){
								var doc = data.data[i];
								// TODO
								zTree.addNodes(treeNode, {
									id: doc.id,
									pId: treeNode.id,
									isParent: !!doc.is_parent,
									name: doc.menu_name
								});
							} // END
						}); */
					},
					onClick: function(event, treeId, treeNode, clickFlag){
						/* ajax({ pid: treeNode.id, json: 0 }, function (data){
							if(!data.success) return;
							// TODO
							var _data = data.data;
							if(!_data) return;
							$('#table1').html(_data);
						}); */
					}
				}
			};

			var zNodes = [ {
				id : '0',
				name : 'Root',
				open : true
			} ,{
				id: '01',
				pId: '0',
				name: '人',
				isParent: true
			}];

			$.fn.zTree.init($("#menuTree"), setting, zNodes);
		});
		</script>
	</body>
</html>